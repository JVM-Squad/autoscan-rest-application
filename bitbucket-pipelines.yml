image: openjdk:14

pipelines:
  default:
    - step:
        caches:
          - gradle
        script:
          - bash ./gradlew check
        after-script:
          - bash ./gradlew jacocoTestReport
          - bash <(curl -s https://codecov.io/bash) -s '*/build/reports/' -f '*report.xml'

  pull-requests:
    feature/*:
      - step:
          caches:
            - gradle
          script:
            - bash ./gradlew check
            - bash ./gradlew sonarqube

  branches:
    master:
      - step:
          caches:
            - gradle
          script:
            - bash ./gradlew check
            - bash ./gradlew sonarqube
          after-script:
            - bash ./gradlew jacocoTestReport
            - bash <(curl -s https://codecov.io/bash) -s "*/build/reports/*" -f '*report.xml'
